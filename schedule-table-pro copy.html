<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Task Schedule Table</title>

  <!-- Tailwind CSS via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#2563eb',
            'primary-hover': '#1d4ed8',
          }
        }
      }
    }
  </script>

  <!-- React & ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

  <!-- Babel for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- React DnD (Drag and Drop) -->
  <script src="https://unpkg.com/react-dnd@14.0.0/dist/umd/react-dnd.min.js"></script>
  <script src="https://unpkg.com/react-dnd-html5-backend@14.0.0/dist/umd/react-dnd-html5-backend.min.js"></script>

  <style>
    .drag-handle {
      cursor: grab;
    }
    .drag-handle:active {
      cursor: grabbing;
    }
    .priority-high { 
      background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
      color: #dc2626;
      border: 1px solid #fca5a5;
      box-shadow: 0 2px 4px rgba(220, 38, 38, 0.1);
    }
    .priority-medium { 
      background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
      color: #d97706;
      border: 1px solid #fcd34d;
      box-shadow: 0 2px 4px rgba(217, 119, 6, 0.1);
    }
    .priority-low { 
      background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
      color: #2563eb;
      border: 1px solid #93c5fd;
      box-shadow: 0 2px 4px rgba(37, 99, 235, 0.1);
    }
    .owner-initial {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 1.75rem;
      height: 1.75rem;
      font-size: 0.75rem;
      font-weight: 500;
      color: white;
      border-radius: 9999px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
    }
    
    /* Enhanced table styling */
    .table-container {
      background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
      border-radius: 1rem;
      padding: 1.5rem;
      box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }
    
    .table-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 0.75rem 0.75rem 0 0;
      padding: 1.5rem;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }
    
    .table-wrapper {
      background: white;
      border-radius: 0 0 0.75rem 0.75rem;
      overflow: hidden;
      box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
    }
    
    .table-header-bg {
      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
    }
    
    .table-row-hover {
      transition: all 0.2s ease;
    }
    
    .table-row-hover:hover {
      background: linear-gradient(90deg, #f8f9ff 0%, #f0f4ff 100%);
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(99, 102, 241, 0.1);
    }
    
    /* Enhanced modal styling */
    .modal-backdrop {
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.8) 0%, rgba(118, 75, 162, 0.8) 100%);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
    }
    
    .modal-content {
      background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3), 0 10px 10px -5px rgba(0, 0, 0, 0.2);
    }
    
    .modal-header-gradient {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 0.75rem 0.75rem 0 0;
    }
    
    .owners-list-item {
      background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
      border: 1px solid #e2e8f0;
      transition: all 0.2s ease;
    }
    
    .owners-list-item:hover {
      background: linear-gradient(135deg, #eef2ff 0%, #e0e7ff 100%);
      border-color: #6366f1;
      transform: translateX(4px);
      box-shadow: 0 4px 6px -1px rgba(99, 102, 241, 0.2);
    }
  </style>
</head>
<body class="min-h-screen font-sans" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%); background-attachment: fixed;">

<div id="root"></div>

<script type="text/babel">
  // Wait for all scripts to load
  window.addEventListener('load', function() {
    try {
      const { useState, useRef, useEffect, useCallback } = React;
      
      // Check if React DnD is available and create safe hooks
      let DndProvider, useDrag, useDrop, HTML5Backend;
      if (typeof ReactDnD !== 'undefined') {
        DndProvider = ReactDnD.DndProvider;
        useDrag = ReactDnD.useDrag;
        useDrop = ReactDnD.useDrop;
      }
      if (typeof ReactDnDHTML5Backend !== 'undefined') {
        HTML5Backend = ReactDnDHTML5Backend.HTML5Backend;
      }
      
      // Create no-op hooks if React DnD is not available (to satisfy React hooks rules)
      const safeUseDrag = useDrag || (() => [{ isDragging: false }, null]);
      const safeUseDrop = useDrop || (() => [{ isOver: false }, null]);

      // Priority options
      const PRIORITY_OPTIONS = [
        { value: 'high', label: 'High', class: 'priority-high' },
        { value: 'medium', label: 'Medium', class: 'priority-medium' },
        { value: 'low', label: 'Low', class: 'priority-low' },
      ];

      // Draggable Row Component (using divs instead of table)
      const DraggableRow = ({ task, index, moveRow, onEdit }) => {
        const ref = useRef(null);
        
        // Always call hooks (React requirement) - use safe versions
        const [{ isDragging }, drag] = safeUseDrag({
          type: 'row',
          item: () => ({ index, id: task.id }),
          collect: (monitor) => ({
            isDragging: monitor ? monitor.isDragging() : false,
          }),
        });

        const [{ isOver }, drop] = safeUseDrop({
          accept: 'row',
          hover: (item, monitor) => {
            if (!ref.current || !monitor) {
              return;
            }
            const dragIndex = item.index;
            const hoverIndex = index;

            if (dragIndex === hoverIndex) {
              return;
            }

            const hoverBoundingRect = ref.current.getBoundingClientRect();
            const hoverMiddleY = (hoverBoundingRect.bottom - hoverBoundingRect.top) / 2;
            const clientOffset = monitor.getClientOffset();
            const hoverClientY = clientOffset ? clientOffset.y - hoverBoundingRect.top : 0;
            
            if (dragIndex < hoverIndex && hoverClientY < hoverMiddleY) {
              return;
            }
            
            if (dragIndex > hoverIndex && hoverClientY > hoverMiddleY) {
              return;
            }
            
            moveRow(dragIndex, hoverIndex);
            item.index = hoverIndex;
          },
          collect: (monitor) => ({
            isOver: monitor ? monitor.isOver() : false,
          }),
        });

        // Connect drag and drop to the ref using useEffect
        useEffect(() => {
          if (drag && drop && ref.current) {
            const node = ref.current;
            drag(drop(node));
            return () => {
              // Cleanup if needed
            };
          }
        }, [drag, drop, ref]);
        
        // Fallback: Native HTML5 drag and drop if React DnD doesn't work
        const handleDragStart = (e) => {
          if (!drag) {
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/plain', index.toString());
            e.currentTarget.style.opacity = '0.5';
          }
        };
        
        const handleDragOver = (e) => {
          if (!drop) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            if (ref.current) {
              ref.current.style.backgroundColor = '#eef2ff';
            }
          }
        };
        
        const handleDragLeave = (e) => {
          if (!drop && ref.current) {
            ref.current.style.backgroundColor = '';
          }
        };
        
        const handleDrop = (e) => {
          if (!drop) {
            e.preventDefault();
            const dragIndex = parseInt(e.dataTransfer.getData('text/plain'));
            const dropIndex = index;
            if (dragIndex !== dropIndex && !isNaN(dragIndex)) {
              moveRow(dragIndex, dropIndex);
            }
            if (ref.current) {
              ref.current.style.backgroundColor = '';
            }
          }
        };
        
        const handleDragEnd = (e) => {
          if (!drag) {
            e.currentTarget.style.opacity = '';
          }
        };

        const formatDateTime = (dateTimeStr) => {
          if (!dateTimeStr) return 'Not set';
          try {
            const date = new Date(dateTimeStr);
            const dateStr = date.toLocaleDateString('en-US', { 
              month: 'short', 
              day: 'numeric', 
              year: 'numeric'
            });
            let hour = date.getHours();
            const ampm = hour >= 12 ? 'PM' : 'AM';
            hour = hour % 12 || 12;
            return `${dateStr}, ${hour} ${ampm}`;
          } catch {
            return dateTimeStr;
          }
        };

        const getInitials = (name) => {
          if (!name) return '?';
          const parts = name.split(' ');
          if (parts.length >= 2) {
            return (parts[0][0] + parts[1][0]).toUpperCase();
          }
          return name.substring(0, 2).toUpperCase();
        };

        return (
          <div
            ref={ref}
            className={`flex items-center border-b border-gray-200 bg-white ${isDragging ? 'opacity-50 bg-blue-50' : ''} ${isOver ? 'border-t-2 border-primary bg-blue-50' : 'table-row-hover'}`}
            style={{ cursor: 'move' }}
            draggable={!drag}
            onDragStart={handleDragStart}
            onDragOver={handleDragOver}
            onDragLeave={handleDragLeave}
            onDrop={handleDrop}
            onDragEnd={handleDragEnd}
            aria-label={`Task: ${task.title}`}
          >
            <div className="px-4 py-3 text-center w-12 flex-shrink-0 flex items-center justify-center">
              <div className="drag-handle text-gray-400 w-5 h-5 inline-flex items-center justify-center" aria-hidden="true">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                  <circle cx="9" cy="12" r="1"></circle>
                  <circle cx="9" cy="5" r="1"></circle>
                  <circle cx="9" cy="19" r="1"></circle>
                  <circle cx="15" cy="12" r="1"></circle>
                  <circle cx="15" cy="5" r="1"></circle>
                  <circle cx="15" cy="19" r="1"></circle>
                </svg>
              </div>
              <span className="sr-only">Drag to reorder</span>
            </div>
            <div className="px-4 py-3 font-medium text-gray-900 flex-1 min-w-0 flex items-center">{task.title}</div>
            <div className="px-4 py-3 w-24 flex-shrink-0 flex items-center">
              <span className={`px-2.5 py-0.5 rounded-full text-xs font-medium border ${PRIORITY_OPTIONS.find(p => p.value === task.priority)?.class || 'priority-medium'}`}>
                {PRIORITY_OPTIONS.find(p => p.value === task.priority)?.label || 'Medium'}
              </span>
            </div>
            <div className="px-4 py-3 text-gray-600 w-24 flex-shrink-0 flex items-center">{task.duration} hrs</div>
            <div className="px-4 py-3 w-32 flex-shrink-0 flex items-center">
              {task.owners && task.owners.length > 0 ? (
                <button
                  onClick={() => onEdit && onEdit.showOwners ? onEdit.showOwners(task.owners) : null}
                  className="flex -space-x-2 items-center cursor-pointer hover:opacity-80 transition-opacity group"
                  aria-label={`View ${task.owners.length} owner(s)`}
                >
                  {task.owners.map((owner, i) => (
                    <span
                      key={i}
                      className={`owner-initial ${i === 0 ? 'bg-blue-600' : i === 1 ? 'bg-green-600' : 'bg-purple-600'} group-hover:ring-2 group-hover:ring-primary group-hover:ring-offset-1 transition-all`}
                      title={owner}
                      aria-label={`Owner: ${owner}`}
                    >
                      {getInitials(owner)}
                    </span>
                  ))}
                </button>
              ) : (
                <span className="text-gray-400 text-sm">None</span>
              )}
            </div>
            <div className="px-4 py-3 text-sm text-gray-600 w-40 flex-shrink-0 whitespace-nowrap flex items-center">{formatDateTime(task.start)}</div>
            <div className="px-4 py-3 text-sm text-gray-600 w-40 flex-shrink-0 whitespace-nowrap flex items-center">{formatDateTime(task.end)}</div>
            <div className="px-4 py-3 text-center w-12 flex-shrink-0 flex items-center justify-center">
              <button
                onClick={() => onEdit && onEdit.edit ? onEdit.edit(task) : null}
                className="text-primary hover:text-primary-hover focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 rounded-md p-1"
                aria-label="Edit task"
              >
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                  <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                  <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                </svg>
              </button>
            </div>
          </div>
        );
      };

      // Edit Modal Component
      const EditModal = ({ task, isOpen, onClose, onSave }) => {
        // Helper function to parse datetime string into date, hour, and AM/PM
        const parseDateTime = (dateTimeStr) => {
          if (!dateTimeStr) return { date: '', hour: '', ampm: 'AM' };
          try {
            const date = new Date(dateTimeStr);
            // Extract only the date part (YYYY-MM-DD) - no time component
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const dateStr = `${year}-${month}-${day}`;
            let hour = date.getHours();
            const ampm = hour >= 12 ? 'PM' : 'AM';
            hour = hour % 12 || 12;
            return { date: dateStr, hour: hour.toString(), ampm };
          } catch {
            return { date: '', hour: '', ampm: 'AM' };
          }
        };

        // Helper function to combine date, hour, and AM/PM into datetime string
        const combineDateTime = (date, hour, ampm) => {
          if (!date || !hour) return '';
          try {
            let hour24 = parseInt(hour);
            if (ampm === 'PM' && hour24 !== 12) {
              hour24 += 12;
            } else if (ampm === 'AM' && hour24 === 12) {
              hour24 = 0;
            }
            return `${date}T${hour24.toString().padStart(2, '0')}:00:00`;
          } catch {
            return '';
          }
        };

        const initialData = task || {
          title: '', priority: 'medium', duration: '', owners: [], start: '', end: ''
        };

        const startParsed = parseDateTime(initialData.start);
        const endParsed = parseDateTime(initialData.end);
        
        // Ensure dates are pure YYYY-MM-DD format with no time component
        const cleanStartDate = startParsed.date ? startParsed.date.split('T')[0].split(' ')[0] : '';
        const cleanEndDate = endParsed.date ? endParsed.date.split('T')[0].split(' ')[0] : '';

        // Default times: Start = 9 AM, End = 5 PM
        const defaultStartHour = startParsed.hour || '9';
        const defaultStartAMPM = startParsed.hour ? startParsed.ampm : 'AM';
        const defaultEndHour = endParsed.hour || '5';
        const defaultEndAMPM = endParsed.hour ? endParsed.ampm : 'PM';

        const [formData, setFormData] = useState({
          ...initialData,
          startDate: cleanStartDate,
          startHour: defaultStartHour,
          startAMPM: defaultStartAMPM,
          endDate: cleanEndDate,
          endHour: defaultEndHour,
          endAMPM: defaultEndAMPM,
        });

        const [ownerInput, setOwnerInput] = useState('');

        useEffect(() => {
          if (task) {
            const startParsed = parseDateTime(task.start);
            const endParsed = parseDateTime(task.end);
            // Ensure dates are pure YYYY-MM-DD format with no time component
            const cleanStartDate = startParsed.date ? startParsed.date.split('T')[0].split(' ')[0] : '';
            const cleanEndDate = endParsed.date ? endParsed.date.split('T')[0].split(' ')[0] : '';
            // Default times: Start = 9 AM, End = 5 PM
            const defaultStartHour = startParsed.hour || '9';
            const defaultStartAMPM = startParsed.hour ? startParsed.ampm : 'AM';
            const defaultEndHour = endParsed.hour || '5';
            const defaultEndAMPM = endParsed.hour ? endParsed.ampm : 'PM';
            setFormData({
              ...task,
              startDate: cleanStartDate,
              startHour: defaultStartHour,
              startAMPM: defaultStartAMPM,
              endDate: cleanEndDate,
              endHour: defaultEndHour,
              endAMPM: defaultEndAMPM,
            });
          }
        }, [task]);

        const handleOwnerAdd = () => {
          if (ownerInput.trim() && !formData.owners.includes(ownerInput.trim())) {
            setFormData({ ...formData, owners: [...formData.owners, ownerInput.trim()] });
            setOwnerInput('');
          }
        };

        const handleOwnerRemove = (index) => {
          setFormData({
            ...formData,
            owners: formData.owners.filter((_, i) => i !== index)
          });
        };

        const handleSave = () => {
          const updatedTask = {
            ...formData,
            start: combineDateTime(formData.startDate, formData.startHour, formData.startAMPM),
            end: combineDateTime(formData.endDate, formData.endHour, formData.endAMPM),
          };
          // Remove the temporary date/time fields
          delete updatedTask.startDate;
          delete updatedTask.startHour;
          delete updatedTask.startAMPM;
          delete updatedTask.endDate;
          delete updatedTask.endHour;
          delete updatedTask.endAMPM;
          onSave(updatedTask);
          onClose();
        };

        if (!isOpen) return null;

        return (
          <div className="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop" role="dialog" aria-modal="true" onClick={(e) => e.target === e.currentTarget && onClose()}>
            <div className="modal-content rounded-xl max-w-lg w-full max-h-screen overflow-hidden flex flex-col" onClick={(e) => e.stopPropagation()}>
              <div className="modal-header-gradient flex justify-between items-center px-6 py-4">
                <h2 className="text-xl font-semibold text-white">Edit Task</h2>
                <button
                  onClick={onClose}
                  className="text-white hover:text-gray-200 focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-purple-600 rounded-md p-1 transition-colors"
                  aria-label="Close modal"
                >
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                  </svg>
                </button>
              </div>
              <div className="flex-1 overflow-y-auto bg-gradient-to-b from-white to-gray-50">
                <div className="p-6 space-y-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">Task Title</label>
                  <input
                    type="text"
                    value={formData.title || ''}
                    onChange={(e) => setFormData({ ...formData, title: e.target.value })}
                    className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary"
                    required
                  />
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">Priority</label>
                  <select
                    value={formData.priority || 'medium'}
                    onChange={(e) => setFormData({ ...formData, priority: e.target.value })}
                    className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary"
                  >
                    {PRIORITY_OPTIONS.map(opt => (
                      <option key={opt.value} value={opt.value}>{opt.label}</option>
                    ))}
                  </select>
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">Duration (hours)</label>
                  <input
                    type="number"
                    min="0.5"
                    step="0.5"
                    value={formData.duration || ''}
                    onChange={(e) => setFormData({ ...formData, duration: e.target.value })}
                    className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary"
                    required
                  />
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">Owners</label>
                  <div className="flex gap-2 mb-2">
                    <input
                      type="text"
                      value={ownerInput}
                      onChange={(e) => setOwnerInput(e.target.value)}
                      onKeyPress={(e) => e.key === 'Enter' && (e.preventDefault(), handleOwnerAdd())}
                      placeholder="Add owner name"
                      className="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary"
                    />
                    <button
                      type="button"
                      onClick={handleOwnerAdd}
                      className="px-4 py-2 bg-primary text-white rounded-md hover:bg-primary-hover focus:outline-none focus:ring-2 focus:ring-primary"
                    >
                      Add
                    </button>
                  </div>
                  <div className="flex flex-wrap gap-2">
                    {(formData.owners || []).map((owner, i) => (
                      <span
                        key={i}
                        className="inline-flex items-center gap-1 px-2.5 py-1 bg-gray-100 text-gray-700 text-sm rounded-full"
                      >
                        {owner}
                        <button
                          type="button"
                          onClick={() => handleOwnerRemove(i)}
                          className="ml-1 text-gray-500 hover:text-red-600"
                          aria-label={`Remove ${owner}`}
                        >
                          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                          </svg>
                        </button>
                      </span>
                    ))}
                  </div>
                </div>

                <div className="space-y-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">Start Date & Time</label>
                    <div className="grid grid-cols-3 gap-3">
                      <div>
                        <label className="block text-xs text-gray-600 mb-1">Date</label>
                        <input
                          type="date"
                          value={formData.startDate ? formData.startDate.split('T')[0].split(' ')[0] : ''}
                          onChange={(e) => {
                            // Ensure only date value is set (no time) - extract just YYYY-MM-DD
                            const dateValue = e.target.value ? e.target.value.split('T')[0].split(' ')[0] : '';
                            setFormData({ ...formData, startDate: dateValue });
                          }}
                          className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary"
                          required
                        />
                      </div>
                      <div>
                        <label className="block text-xs text-gray-600 mb-1">Hour</label>
                        <input
                          type="number"
                          min="1"
                          max="12"
                          value={formData.startHour || ''}
                          onChange={(e) => setFormData({ ...formData, startHour: e.target.value })}
                          placeholder="Hour"
                          className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary"
                          style={{ WebkitAppearance: 'textfield', MozAppearance: 'textfield' }}
                          required
                        />
                      </div>
                      <div>
                        <label className="block text-xs text-gray-600 mb-1">AM/PM</label>
                        <select
                          value={formData.startAMPM || 'AM'}
                          onChange={(e) => setFormData({ ...formData, startAMPM: e.target.value })}
                          className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary"
                          required
                        >
                          <option value="AM">AM</option>
                          <option value="PM">PM</option>
                        </select>
                      </div>
                    </div>
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">End Date & Time</label>
                    <div className="grid grid-cols-3 gap-3">
                      <div>
                        <label className="block text-xs text-gray-600 mb-1">Date</label>
                        <input
                          type="date"
                          value={formData.endDate ? formData.endDate.split('T')[0].split(' ')[0] : ''}
                          onChange={(e) => {
                            // Ensure only date value is set (no time) - extract just YYYY-MM-DD
                            const dateValue = e.target.value ? e.target.value.split('T')[0].split(' ')[0] : '';
                            setFormData({ ...formData, endDate: dateValue });
                          }}
                          className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary"
                          required
                        />
                      </div>
                      <div>
                        <label className="block text-xs text-gray-600 mb-1">Hour</label>
                        <input
                          type="number"
                          min="1"
                          max="12"
                          value={formData.endHour || ''}
                          onChange={(e) => setFormData({ ...formData, endHour: e.target.value })}
                          placeholder="Hour"
                          className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary"
                          style={{ WebkitAppearance: 'textfield', MozAppearance: 'textfield' }}
                          required
                        />
                      </div>
                      <div>
                        <label className="block text-xs text-gray-600 mb-1">AM/PM</label>
                        <select
                          value={formData.endAMPM || 'AM'}
                          onChange={(e) => setFormData({ ...formData, endAMPM: e.target.value })}
                          className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary"
                          required
                        >
                          <option value="AM">AM</option>
                          <option value="PM">PM</option>
                        </select>
                      </div>
                    </div>
                  </div>
                </div>
                </div>
              </div>
              <div className="px-6 py-4 bg-gray-50 border-t border-gray-200 flex justify-end gap-3">
                <button
                  type="button"
                  onClick={onClose}
                  className="px-6 py-2 border-2 border-gray-300 text-gray-700 rounded-md hover:bg-gray-100 hover:border-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 transition-all"
                >
                  Cancel
                </button>
                <button
                  type="button"
                  onClick={handleSave}
                  className="px-6 py-2 bg-gradient-to-r from-primary to-purple-600 text-white rounded-md hover:from-primary-hover hover:to-purple-700 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-all shadow-md hover:shadow-lg transform hover:-translate-y-0.5"
                >
                  Save Changes
                </button>
              </div>
            </div>
          </div>
        );
      };

      // Owners List Modal Component
      const OwnersListModal = ({ owners, isOpen, onClose }) => {
        if (!isOpen || !owners || owners.length === 0) return null;

        return (
          <div className="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop" role="dialog" aria-modal="true" onClick={onClose}>
            <div className="modal-content rounded-xl max-w-md w-full overflow-hidden" onClick={(e) => e.stopPropagation()}>
              <div className="modal-header-gradient flex justify-between items-center px-6 py-4">
                <h2 className="text-xl font-semibold text-white">Task Owners</h2>
                <button
                  onClick={onClose}
                  className="text-white hover:text-gray-200 focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-purple-600 rounded-md p-1 transition-colors"
                  aria-label="Close modal"
                >
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                  </svg>
                </button>
              </div>
              <div className="p-6 space-y-3 bg-gradient-to-b from-white to-gray-50">
                {owners.map((owner, index) => (
                  <div
                    key={index}
                    className="owners-list-item flex items-center gap-3 p-4 rounded-lg"
                  >
                    <span className={`owner-initial ${index === 0 ? 'bg-blue-600' : index === 1 ? 'bg-green-600' : 'bg-purple-600'}`}>
                      {owner.split(' ').map(n => n[0]).join('').toUpperCase()}
                    </span>
                    <span className="text-gray-900 font-medium text-base">{owner}</span>
                  </div>
                ))}
              </div>
              <div className="px-6 py-4 bg-gray-50 border-t border-gray-200 flex justify-end">
                <button
                  onClick={onClose}
                  className="px-6 py-2 bg-gradient-to-r from-primary to-purple-600 text-white rounded-md hover:from-primary-hover hover:to-purple-700 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-all shadow-md hover:shadow-lg transform hover:-translate-y-0.5"
                >
                  Close
                </button>
              </div>
            </div>
          </div>
        );
      };

      // Main App Component
      const App = () => {
        const [tasks, setTasks] = useState([
          { id: 1, title: 'Design System Update', priority: 'high', duration: 8, owners: ['Alice Johnson', 'Bob Lee'], start: '2025-11-15T09:00', end: '2025-11-15T17:00' },
          { id: 2, title: 'API Integration', priority: 'medium', duration: 6, owners: ['Charlie Kim'], start: '2025-11-16T10:00', end: '2025-11-16T16:00' },
          { id: 3, title: 'User Testing Session', priority: 'low', duration: 4, owners: ['Diana Prince', 'Eve Adams'], start: '2025-11-17T13:00', end: '2025-11-17T17:00' },
        ]);

        const [editingTask, setEditingTask] = useState(null);
        const [isModalOpen, setIsModalOpen] = useState(false);
        const [ownersModalOpen, setOwnersModalOpen] = useState(false);
        const [selectedOwners, setSelectedOwners] = useState([]);

        const moveRow = useCallback((fromIndex, toIndex) => {
          setTasks((prevTasks) => {
            const newTasks = [...prevTasks];
            const [moved] = newTasks.splice(fromIndex, 1);
            newTasks.splice(toIndex, 0, moved);
            return newTasks;
          });
        }, []);

        const handleEdit = (task) => {
          setEditingTask({ ...task });
          setIsModalOpen(true);
        };

        const handleSave = (updatedTask) => {
          setTasks(tasks.map(t => t.id === updatedTask.id ? { ...updatedTask, id: t.id } : t));
        };

        const handleCloseModal = () => {
          setIsModalOpen(false);
          setEditingTask(null);
        };

        const handleShowOwners = (owners) => {
          setSelectedOwners(owners || []);
          setOwnersModalOpen(true);
        };

        const handleCloseOwnersModal = () => {
          setOwnersModalOpen(false);
          setSelectedOwners([]);
        };

        const TableContent = () => (
          <div className="container mx-auto p-6 max-w-7xl">
            <div className="table-container">
              <div className="table-header">
                <div className="flex justify-between items-center">
                  <div>
                    <h1 className="text-2xl font-bold text-white">Task Schedule</h1>
                    <p className="text-sm text-white/90 mt-1">Drag rows to reorder tasks</p>
                  </div>
                  <button
                    onClick={() => {
                      const newTask = {
                        id: Date.now(),
                        title: 'New Task',
                        priority: 'medium',
                        duration: 0,
                        owners: [],
                        start: '',
                        end: ''
                      };
                      setTasks([...tasks, newTask]);
                      // Set default times: Start = 9 AM, End = 5 PM
                      setEditingTask({
                        ...newTask,
                        startHour: '9',
                        startAMPM: 'AM',
                        endHour: '5',
                        endAMPM: 'PM'
                      });
                      setIsModalOpen(true);
                    }}
                    className="px-4 py-2 bg-white text-primary rounded-md hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-purple-600 transition-all shadow-md hover:shadow-lg transform hover:-translate-y-0.5 font-semibold"
                  >
                    + Add Row
                  </button>
                </div>
              </div>

              <div className="table-wrapper">
                <div className="overflow-x-auto">
                  {/* Header Row */}
                  <div className="table-header-bg border-b-2 border-gray-300 flex items-center sticky top-0 z-10">
                    <div className="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider w-12 flex-shrink-0">
                      <span className="sr-only">Reorder</span>
                    </div>
                    <div className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider flex-1 min-w-0">Task Title</div>
                    <div className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-24 flex-shrink-0">Priority</div>
                    <div className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-24 flex-shrink-0">Duration</div>
                    <div className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-32 flex-shrink-0">Owners</div>
                    <div className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-40 flex-shrink-0 whitespace-nowrap">Start</div>
                    <div className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-40 flex-shrink-0 whitespace-nowrap">End</div>
                    <div className="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider w-12 flex-shrink-0">
                      <span className="sr-only">Actions</span>
                    </div>
                  </div>
                  
                  {/* Draggable Rows */}
                  <div className="bg-white">
                    {tasks.map((task, index) => (
                      <DraggableRow
                        key={task.id}
                        task={task}
                        index={index}
                        moveRow={moveRow}
                        onEdit={{ edit: handleEdit, showOwners: handleShowOwners }}
                      />
                    ))}
                  </div>
                </div>
              </div>
            </div>

            <EditModal
              task={editingTask}
              isOpen={isModalOpen}
              onClose={handleCloseModal}
              onSave={handleSave}
            />

            <OwnersListModal
              owners={selectedOwners}
              isOpen={ownersModalOpen}
              onClose={handleCloseOwnersModal}
            />
          </div>
        );

        // Wrap with DndProvider if available, otherwise render without it
        if (DndProvider && HTML5Backend) {
          return (
            <DndProvider backend={HTML5Backend}>
              <TableContent />
            </DndProvider>
          );
        } else {
          console.warn('React DnD not available, drag and drop disabled');
          return <TableContent />;
        }
      };

      // Render App - Use ReactDOM.render for better compatibility
      ReactDOM.render(<App />, document.getElementById('root'));
      
    } catch (error) {
      console.error('Error rendering app:', error);
      document.getElementById('root').innerHTML = `
        <div style="padding: 2rem; text-align: center; font-family: system-ui, sans-serif;">
          <h1 style="color: #ef4444; margin-bottom: 1rem; font-size: 1.5rem;">Error Loading Application</h1>
          <p style="color: #6b7280; margin-bottom: 0.5rem;">${error.message}</p>
          <p style="color: #6b7280; margin-top: 1rem; font-size: 0.875rem;">Please check the browser console for details.</p>
        </div>
      `;
    }
  });
</script>

</body>
</html>
